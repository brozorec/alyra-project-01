{"version":3,"sources":["getWeb3.js","Admin.jsx","Public.jsx","App.jsx","serviceWorker.js","index.js"],"names":["web3Instance","getWeb3","Promise","resolve","reject","window","ethereum","Web3","web3","console","log","provider","providers","WebsocketProvider","getContract","contract","a","eth","net","getId","networkId","deployedNetwork","networks","instance","Contract","abi","address","Admin","account","setMsg","useState","addr","setAddr","activeStep","setActiveStep","useEffect","Voting","methods","status","call","response","Number","getStep","whitelistAddr","whitelist","send","from","err","tx","getTransactionReceipt","receipt","nextStep","changeToNextStatus","setWinner","noValidate","autoComplete","Grid","direction","container","spacing","style","paddingTop","item","TextField","id","label","onChange","target","value","color","Button","variant","onClick","disabled","Stepper","alternativeLabel","map","Step","key","StepLabel","Public","newProposal","setNewProposal","winningProposal","setWinningProposal","proposals","setProposals","getWinner","winningProposalId","proposalsArray","proposalsCount","i","push","getProposals","registerProposal","description","voteCount","vote","padding","TextareaAutosize","rowsMin","marginTop","proposal","md","Card","CardContent","Typography","gutterBottom","component","CardActions","size","CHAIN_ID","App","wallet","useWallet","setAccount","msg","chainId","setChainId","on","connect","chainID","getAccounts","accounts","className","exact","path","Snackbar","autoHideDuration","open","onClose","message","Boolean","location","hostname","match","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.28af556c.chunk.js","sourcesContent":["import Web3 from \"web3\";\n\nlet web3Instance;\n\nconst getWeb3 = () =>\n  new Promise((resolve, reject) => {\n    // Wait for loading completion to avoid race conditions with web3 injection timing.\n    //window.addEventListener(\"load\", async () => {\n      //Modern dapp browsers...\n      if (window.ethereum) {\n        web3Instance = web3Instance || new Web3(window.ethereum);\n        // Request account access if needed\n        resolve(web3Instance);\n        //window.ethereum.enable()\n          //.then(_ => resolve(web3Instance))\n          //.catch(err => reject(err))\n      }\n      // Legacy dapp browsers...\n      else if (window.web3) {\n        // Use Mist/MetaMask's provider.\n        const web3 = window.web3;\n        console.log(\"Injected web3 detected.\");\n        resolve(web3);\n      }\n      // Fallback to localhost; use dev console port by default...\n      else {\n        const provider = new Web3.providers.WebsocketProvider(\n          \"ws://127.0.0.1:8545\"\n        );\n        const web3 = new Web3(provider);\n        console.log(\"No web3 instance injected, using Local web3.\");\n        resolve(web3);\n      }\n    //});\n  });\n\nexport default getWeb3;\n\n","import React, { useState, useEffect } from \"react\";\nimport Voting from \"./contracts/Voting.json\";\nimport getWeb3 from \"./getWeb3\";\nimport TextField from '@material-ui/core/TextField';\nimport Button from '@material-ui/core/Button';\nimport Grid from '@material-ui/core/Grid';\nimport Stepper from '@material-ui/core/Stepper';\nimport Step from '@material-ui/core/Step';\nimport StepLabel from '@material-ui/core/StepLabel';\n\nconst getContract = async (contract) => {\n  const web3 = await getWeb3();\n\n  // Get the contract instance.\n  const networkId = await web3.eth.net.getId();\n  const deployedNetwork = contract.networks[networkId];\n  const instance = new web3.eth.Contract(\n    contract.abi,\n    deployedNetwork && deployedNetwork.address,\n  );\n\n  return instance;\n}\n\nfunction Admin({ account, setMsg }) {\n  const steps = [\n    \"Enregistrement des votants\",\n    \"Début d'enregistrement des propositions\",\n    \"Fin d'enregistrement des propositions\",\n    \"Début du vote\",\n    \"Fin du vote\",\n    \"Votes comptés\"\n  ];\n  const [addr, setAddr] = useState();\n  const [activeStep, setActiveStep] = useState(0);\n\n  useEffect(() => {\n    const getStep = async () => {\n      const contract = await getContract(Voting);\n      const response = await contract.methods.status().call();\n      setActiveStep(Number(response));\n    }\n\n    getStep();\n  }, []);\n\n  const whitelistAddr = async () => {\n    const contract = await getContract(Voting);\n    const web3 = await getWeb3();\n\n    console.log(addr);\n    await contract.methods.whitelist(addr).send({ from: account }, async function(err, tx) {\n      if (tx) {\n        console.log(tx);\n        await web3.eth.getTransactionReceipt(tx, async function(err, receipt) {\n          console.log(receipt);\n\n          if(receipt.status){\n            setAddr(null);\n            setMsg(`L'adresse ${addr} a été enregistrée !`);\n          }\n        })\n      }\n      else if (err) {\n        console.log(err);\n        setMsg('error');\n      }\n    });\n  }\n\n  const nextStep = async() => {\n    const contract = await getContract(Voting);\n    const web3 = await getWeb3();\n\n    await contract.methods.changeToNextStatus().send({ from: account }, async function(err, tx) {\n      if (tx) {\n        console.log(tx);\n        await web3.eth.getTransactionReceipt(tx, async function(err, receipt) {\n          console.log(receipt);\n\n          if(receipt.status){\n            if (activeStep < 4)\n              setActiveStep(activeStep + 1);\n            setMsg('Le statut du vote a été changé !');\n          }\n        })\n      }\n      else if (err) {\n        console.log(err);\n        setMsg('error');\n      }\n    });\n  }\n\n  const setWinner = async() => {\n    const contract = await getContract(Voting);\n    const web3 = await getWeb3();\n\n    await contract.methods.setWinner().send({ from: account }, async function(err, tx) {\n      if (tx) {\n        console.log(tx);\n        await web3.eth.getTransactionReceipt(tx, async function(err, receipt) {\n          console.log(receipt);\n\n          if(receipt.status){\n            setActiveStep(5);\n            setMsg('Les votes ont été comptés et la proposition gagnante a été declarée !');\n          }\n        })\n      }\n      else if (err) {\n        console.log(err);\n        setMsg('error');\n      }\n    });\n  }\n\n  return (\n    <div>\n      <h2>Administration</h2>\n      <form noValidate autoComplete=\"off\">\n        <Grid direction=\"column\" container spacing={3} style={{ paddingTop: \"100px\" }}>\n          <Grid item>\n            <h4>Enregistrement d'un votant</h4>\n          </Grid>\n          <Grid item>\n            <TextField id=\"standard-basic\" label=\"Adresse\" onChange={({ target }) => setAddr(target.value)}/>\n          </Grid>\n          <Grid item>\n            <h5 style={{ color: \"red\" }}>\n              {activeStep !== 0 ? \"Enregistrement des votants fermé !\" : \"\"}\n            </h5>\n            <Button variant=\"contained\" color=\"primary\" onClick={() => whitelistAddr()} disabled={activeStep !== 0}>\n              Whitelist\n            </Button>\n          </Grid>\n        </Grid>\n      </form>\n      <Grid direction=\"column\" container spacing={3} style={{ paddingTop: \"100px\" }}>\n        <Grid item>\n          <h4>Étapes du vote</h4>\n        </Grid>\n        <Grid item>\n          <Stepper activeStep={activeStep} alternativeLabel>\n            {steps.map((label) => (\n              <Step key={label}>\n                <StepLabel>{label}</StepLabel>\n              </Step>\n            ))}\n          </Stepper>\n        </Grid>\n        <Grid item>{\n          activeStep === 4\n            ? <Button variant=\"contained\" color=\"secondary\" onClick={() => setWinner()}>\n              Compter les votes\n            </Button>\n            : <Button variant=\"contained\" color=\"primary\" onClick={() => nextStep()} disabled={activeStep === 5}>\n              Étape suivante\n            </Button>\n          }\n        </Grid>\n      </Grid>\n    </div>\n  );\n}\n\nexport default Admin;\n","import React, { useState, useEffect } from \"react\";\nimport Voting from \"./contracts/Voting.json\";\nimport getWeb3 from \"./getWeb3\";\nimport TextareaAutosize from '@material-ui/core/TextareaAutosize';\nimport Grid from '@material-ui/core/Grid';\nimport Stepper from '@material-ui/core/Stepper';\nimport Step from '@material-ui/core/Step';\nimport StepLabel from '@material-ui/core/StepLabel';\nimport Card from '@material-ui/core/Card';\nimport CardActions from '@material-ui/core/CardActions';\nimport CardContent from '@material-ui/core/CardContent';\nimport Button from '@material-ui/core/Button';\nimport Typography from '@material-ui/core/Typography';\n\nconst getContract = async (contract) => {\n  const web3 = await getWeb3();\n\n  // Get the contract instance.\n  const networkId = await web3.eth.net.getId();\n  const deployedNetwork = contract.networks[networkId];\n  const instance = new web3.eth.Contract(\n    contract.abi,\n    deployedNetwork && deployedNetwork.address,\n  );\n\n  return instance;\n}\n\nfunction Public({ account, setMsg }) {\n  const steps = [\n    \"Enregistrement des votants\",\n    \"Début d'enregistrement des propositions\",\n    \"Fin d'enregistrement des propositions\",\n    \"Début du vote\",\n    \"Fin du vote\",\n    \"Votes comptés\"\n  ];\n  const [activeStep, setActiveStep] = useState(0);\n  const [newProposal, setNewProposal] = useState();\n  const [winningProposal, setWinningProposal] = useState();\n  const [proposals, setProposals] = useState([]);\n\n  useEffect(() => {\n    const getStep = async () => {\n      const contract = await getContract(Voting);\n      const response = await contract.methods.status().call();\n      setActiveStep(Number(response));\n    }\n\n    getStep();\n  }, []);\n\n  useEffect(() => {\n    const getWinner = async () => {\n      const contract = await getContract(Voting);\n      const id = await contract.methods.winningProposalId().call();\n      const response = await contract.methods.proposals(id - 1).call();\n      setWinningProposal(response);\n    }\n\n    console.log(activeStep);\n    if (activeStep === 5)\n      getWinner();\n  }, [activeStep]);\n\n  useEffect(() => {\n    const getProposals = async () => {\n      const contract = await getContract(Voting);\n      const proposalsArray = [];\n      const proposalsCount = await contract.methods.proposalsCount().call();\n      for (let i = 0; i < proposalsCount; i++) {\n        const response = await contract.methods.proposals(i).call();\n        proposalsArray.push(response)\n      }\n      setProposals(proposalsArray);\n    }\n\n    getProposals();\n  }, []);\n\n  const registerProposal = async () => {\n    const contract = await getContract(Voting);\n    const web3 = await getWeb3();\n\n    await contract.methods.registerProposal(newProposal).send({ from: account }, async function(err, tx) {\n      if (tx) {\n        console.log(tx);\n        await web3.eth.getTransactionReceipt(tx, async function(err, receipt) {\n          console.log(receipt);\n\n          if(receipt.status){\n            setNewProposal('');\n            setProposals([...proposals, { description: newProposal, voteCount: 0 }])\n            setMsg('Votre proposition a été enregistrée !');\n          }\n        })\n      }\n      else if (err) {\n        console.log(err);\n        setMsg('error');\n      }\n    });\n  }\n\n  const vote = async (i) => {\n    const contract = await getContract(Voting);\n    const web3 = await getWeb3();\n\n    await contract.methods.vote(i + 1).send({ from: account }, async function(err, tx) {\n      if (tx) {\n        console.log(tx);\n        await web3.eth.getTransactionReceipt(tx, async function(err, receipt) {\n          console.log(receipt);\n\n          if(receipt.status){\n            setMsg('Votre vote a été enregistré !');\n          }\n        })\n      }\n      else if (err) {\n        console.log(err);\n        setMsg('error');\n      }\n    });\n  }\n\n  return (\n    <Grid direction=\"column\" container spacing={3} style={{ padding: \"100px\" }}>\n      <Grid item>\n        <h4>Étapes du vote</h4>\n      </Grid>\n      <Grid item>\n        <Stepper activeStep={activeStep} alternativeLabel>\n          {steps.map((label) => (\n            <Step key={label}>\n              <StepLabel>{label}</StepLabel>\n            </Step>\n          ))}\n        </Stepper>\n      </Grid>\n      <Grid item>\n        <form noValidate autoComplete=\"off\">\n          <Grid direction=\"column\" container spacing={3} style={{ paddingTop: \"100px\" }}>\n            <Grid item>\n              <h4>Enregistrement d'une proposition</h4>\n              <h5 style={{ color: \"red\" }}>\n                {activeStep === 0\n                  ? \"Enregistrement des propositions n'est pas encore ouvert !\"\n                  : activeStep !== 1\n                    ? \"Enregistrement des propositions est fermé !\"\n                    : \"\"\n                }\n              </h5>\n            </Grid>\n            <Grid item>\n              <TextareaAutosize rowsMin={6} id=\"standard-basic\" label=\"Adresse\" onChange={({ target }) => setNewProposal(target.value)}/>\n            </Grid>\n            <Grid item>\n              <Button variant=\"contained\" color=\"primary\" onClick={() => registerProposal()} disabled={activeStep !== 1}>\n                Enregistrer\n              </Button>\n            </Grid>\n          </Grid>\n        </form>\n      </Grid>\n\n      <Grid item style={{ marginTop: 100 }}>\n        <h4>Propositions</h4>\n        <h5 style={{ color: \"red\" }}>\n          {activeStep < 3\n            ? \"Le vote n'a pas encore ouvert !\"\n            : activeStep > 4\n              ? \"Le vote a déjà terminé !\"\n              : \"\"\n          }\n        </h5>\n      </Grid>\n      <Grid item>\n        <Grid container spacing={2}>\n          {proposals && proposals.map((proposal, i) => (\n            <Grid item key={i} md={3}>\n              <Card variant=\"outlined\">\n                <CardContent>\n                  <Typography color=\"textSecondary\" gutterBottom>\n                    Proposition {i + 1}\n                  </Typography>\n                  <Typography variant=\"body2\" component=\"p\">\n                    {proposal.description}\n                  </Typography>\n                </CardContent>\n                <CardActions>\n                  <Button size=\"small\" onClick={() => vote(i)} disabled={activeStep !== 3}>Voter</Button>\n                </CardActions>\n              </Card>\n            </Grid>\n          ))\n          }</Grid>\n      </Grid>\n\n      <Grid item style={{ marginTop: 50 }}>\n        <h4>Proposition gagnante</h4>\n        <h5 style={{ color: \"red\" }}>\n          {activeStep < 5\n            ? \"La proposition gagnante n'est pas encore annoncée !\"\n            : \"\"\n          }\n        </h5>\n      </Grid>\n      {winningProposal && (\n        <Grid item>\n          <Card>\n            <CardContent>\n              <Typography variant=\"body2\" component=\"p\">\n                {winningProposal.description}\n              </Typography>\n              <Typography variant=\"body1\" component=\"p\">\n                Votes : <b>{winningProposal.voteCount}</b>\n              </Typography>\n            </CardContent>\n          </Card>\n        </Grid>\n      )}\n    </Grid>\n  );\n}\n\nexport default Public;\n","import React, { useState, useEffect } from \"react\";\nimport { useWallet, UseWalletProvider } from 'use-wallet';\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n} from \"react-router-dom\";\nimport getWeb3 from \"./getWeb3\";\nimport Snackbar from '@material-ui/core/Snackbar';\n\nimport \"./App.css\";\nimport Admin from \"./Admin\";\nimport Public from \"./Public\";\n\nconst CHAIN_ID = 42;\n\nfunction App() {\n  const wallet = useWallet();\n\n  const [account, setAccount] = useState(null);\n  const [msg, setMsg] = useState();\n  const [chainId, setChainId] = useState(\n    Number(window.ethereum ? window.ethereum.chainId : null)\n  );\n\n  useEffect(() => {\n    if (window.ethereum && window.ethereum.on) {\n      window.ethereum.on('accountsChanged', () => {\n        wallet.connect();\n      });\n\n      window.ethereum.on('chainChanged', (chainID) => {\n        setChainId(Number(chainID));\n      });\n    }\n  }, [wallet, chainId]);\n\n  useEffect(() => {\n    const getAccounts = async () => {\n      // Get network provider and web3 instance.\n      const web3 = await getWeb3();\n      // Use web3 to get the user's accounts.\n      const accounts = await web3.eth.getAccounts();\n      setAccount(accounts[0])\n    };\n\n    getAccounts();\n  }, []);\n\n  const loadApp = () => (\n    <>\n      <Router>\n        <Switch>\n          <Route exact path=\"/\">\n            <Public account={account} setMsg={setMsg} />\n          </Route>\n          <Route path=\"/admin\">\n            <Admin account={account} setMsg={setMsg} />\n          </Route>\n        </Switch>\n      </Router>\n      <Snackbar autoHideDuration={6000} open={!!msg} onClose={() => setMsg(null)} message={msg}/>\n    </>\n  )\n\n  return (\n    <div className=\"App\">{\n      chainId !== CHAIN_ID\n        ? <p>Utilisez le réseau Kovan, svp !</p>\n        : loadApp()\n      }\n    </div>\n  );\n}\n\nexport default () => (\n  <UseWalletProvider chainId={CHAIN_ID}>\n    <App/>\n  </UseWalletProvider>\n)\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}